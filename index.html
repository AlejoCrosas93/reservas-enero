<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reservas Enero</title>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .slot { border: 1px solid #ccc; padding: 10px; margin: 6px 0; }
    button { margin-top: 5px; }
  </style>
</head>
<body>

<h2>Reservas Enero</h2>

<label>Nombre:</label><br>
<input type="text" id="nombre" placeholder="Tu nombre completo" /><br><br>

<label>Email:</label><br>
<input type="email" id="email" placeholder="tu@email.com" /><br><br>

<button onclick="cargar()">Cargar salidas</button>

<div id="lista"></div>
 
<script>
async function cargar() {
  console.log("ğŸ‘‰ cargar() ejecutada");
  const nombre = document.getElementById("nombre").value;
  const email = document.getElementById("email").value;

  if (!nombre) return alert("Ingresa tu nombre");
  if (!email) return alert("Ingresa tu email");

  const cont = document.getElementById("lista");
  cont.innerHTML = "";

  const snap = await db.collection("salidas").get();

  snap.forEach(doc => {
    const d = doc.data();

    // âŒ No mostrar ocupadas
    if (d.ocupada === true) return;

    const div = document.createElement("div");
    div.className = "slot";

    div.innerHTML = `
      <b>${diaSemana(d.fecha)} ${d.fecha}</b><br>
      ğŸ•˜ ${d.hora}<br>
      ğŸ“ <b>${d.lugar}</b><br>
      <small>${d.direccion}</small><br><br>
      <button>Reservar</button>
    `;

    div.querySelector("button").onclick = async () => {
      await db.collection("salidas").doc(doc.id).update({
        ocupada: true,
        email: email,
        reservadoPor: nombre
      });

      alert("Reservado");
      cargar();
    };

    cont.appendChild(div);
  });
}
</script>

</body>
</html>
